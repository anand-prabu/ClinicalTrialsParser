<html>
<head>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
</head>
<body>
<div id="map" style="width: 600px; height: 400px"></div>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script>

var jsonOSF = JSON.parse('{"geo_data":[{"city": "Charlottesville", "country": "United States", "name": "Center for Research in Reproduction, University of Virginia", "state": "Virginia", "zip": "22908","latitude": 40.029306,"longitude": -80.4766781},{"city": "Ljubljana","country": "Slovenia","name": "UMC Ljubljana, Department of Infectious Diseases","zip":"1525","state": null,"latitude": 46.049865,"longitude": 14.5068921},{"city": "Baltimore","country": "United States","name": "Johns Hopkins University (BPRU) Bayview Campus","zip": "21224 6823","state": "Maryland","latitude": 39.2908608,"longitude": -76.6108073},{"city": "New Haven","country": "United States","name": "VA Connecticut Healthcare System","zip": "06519","state": "Connecticut","latitude": 41.3082138,"longitude": -72.9250518}]}');

var coordinateList = new Array();
for (var x in jsonOSF["geo_data"]){
    coordinateList.push(L.latLng(jsonOSF["geo_data"][x]["latitude"],jsonOSF["geo_data"][x]["longitude"]));
};


var map = L.map('map',{
	worldCopyJump:true
}).setView(coordinateList[0], 8);

map.fitBounds(coordinateList);


L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
}).addTo(map);


for (var y in coordinateList){
    studyLocation = L.marker(coordinateList[y]).addTo(map);
    if (jsonOSF["geo_data"][y]["state"] !== null){
        studyLocation.bindPopup("<b>"+ jsonOSF["geo_data"][y]["name"] +"</b><br>"+jsonOSF["geo_data"][y]["city"]+", "+jsonOSF["geo_data"][y]["state"]+"<br>"+jsonOSF["geo_data"][y]["country"]);
    } 
    else {
        studyLocation.bindPopup("<b>"+ jsonOSF["geo_data"][y]["name"] +"</b><br>"+jsonOSF["geo_data"][y]["city"]+"<br>"+jsonOSF["geo_data"][y]["country"]);
    };
};


</script>
<p>Nominatim Search Courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png"></p>
<!--http://developer.mapquest.com/web/info/terms-of-use #9 is relevant if we're using Mapquest's Nonatim (OpenStreetMaps) API. -->
<!--http://wiki.openstreetmap.org/wiki/Legal_FAQ#3a._I_would_like_to_use_OpenStreetMap_maps._How_should_I_credit_you.3F describes how to properly attribute Open Street Maps.-->
<!--http://developer.mapquest.com/web/products/open/nominatim The terms of use for the nominatim service provided by mapquest. -->
</body>
</html>